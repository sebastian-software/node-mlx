#!/bin/sh

echo "üîç Running pre-push checks..."

# TypeScript/JavaScript linting
echo "‚Üí ESLint..."
pnpm lint || {
  echo "‚ùå ESLint failed. Fix errors before pushing."
  exit 1
}

# TypeScript type checking
echo "‚Üí TypeScript..."
pnpm typecheck || {
  echo "‚ùå TypeScript errors. Fix before pushing."
  exit 1
}

# Swift format check (if swift files changed)
if git diff --cached --name-only origin/main | grep -q '\.swift$'; then
  echo "‚Üí SwiftFormat check..."
  cd packages/swift
  if command -v swiftformat &> /dev/null; then
    swiftformat Sources Tests --lint 2>/dev/null || {
      echo "‚ùå SwiftFormat issues found. Run 'swiftformat .' to fix."
      exit 1
    }
  fi
  cd ../..
fi

echo "‚úÖ All pre-push checks passed!"
